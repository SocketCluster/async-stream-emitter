/**
 * AsyncStreamEmitter v3.0.3 browser bundle
 */
 !function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).AsyncStreamEmitter=e()}}(function(){return function(){return function e(t,s,r){function i(u,o){if(!s[u]){if(!t[u]){var a="function"==typeof require&&require;if(!o&&a)return a(u,!0);if(n)return n(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var m=s[u]={exports:{}};t[u][0].call(m.exports,function(e){return i(t[u][1][e]||e)},m,m.exports,e,t,s,r)}return s[u].exports}for(var n="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}}()({1:[function(e,t){t.exports=class{async next(e){let t=this.createConsumer(e),s=await t.next();return t.return(),s}async once(e){let t=await this.next(e);return t.done&&await new Promise(()=>{}),t.value}createConsumer(){throw new TypeError("Method must be overriden by subclass")}createConsumable(e){let t=this.createConsumer(e);return{[Symbol.asyncIterator]:()=>t}}[Symbol.asyncIterator](){return this.createConsumer()}}},{}],2:[function(e,t){const s=e("consumable-stream");t.exports=class extends s{constructor(e,t){super(),this.name=t,this._streamDemux=e}createConsumer(e){return this._streamDemux.createConsumer(this.name,e)}}},{"consumable-stream":1}],3:[function(e,t){const s=e("writable-consumable-stream"),r=e("./demuxed-consumable-stream");t.exports=class{constructor(){this._mainStream=new s}write(e,t){this._mainStream.write({stream:e,data:{value:t,done:!1}})}close(e,t){this._mainStream.write({stream:e,data:{value:t,done:!0}})}closeAll(e){this._mainStream.close(e)}writeToConsumer(e,t){this._mainStream.writeToConsumer(e,{consumerId:e,data:{value:t,done:!1}})}closeConsumer(e,t){this._mainStream.closeConsumer(e,{consumerId:e,data:{value:t,done:!0}})}getConsumerStats(e){return this._mainStream.getConsumerStats(e)}getConsumerStatsList(e){return this._mainStream.getConsumerStatsList().filter(t=>t.stream===e)}getConsumerStatsListAll(){return this._mainStream.getConsumerStatsList()}kill(e,t){let s=this.getConsumerStatsList(e),r=s.length;for(let e=0;e<r;e++)this.killConsumer(s[e].id,t)}killAll(e){this._mainStream.kill(e)}killConsumer(e,t){this._mainStream.killConsumer(e,t)}getBackpressure(e){let t=this.getConsumerStatsList(e),s=t.length,r=0;for(let e=0;e<s;e++){let s=t[e];s.backpressure>r&&(r=s.backpressure)}return r}getBackpressureAll(){return this._mainStream.getBackpressure()}getConsumerBackpressure(e){return this._mainStream.getConsumerBackpressure(e)}hasConsumer(e,t){let s=this._mainStream.getConsumerStats(t);return!!s&&s.stream===e}hasConsumerAll(e){return this._mainStream.hasConsumer(e)}createConsumer(e,t){let s=this._mainStream.createConsumer(t),r=s.next;s.next=async function(){for(;;){let t=await r.apply(this,arguments);if(t.value&&(t.value.stream===e||t.value.consumerId===this.id))return t.value.data.done&&this.return(),t.value.data;if(t.done)return t}};let i=s.getStats;s.getStats=function(){let t=i.apply(this,arguments);return t.stream=e,t};let n=s.applyBackpressure;s.applyBackpressure=function(t){!t.value||t.value.stream!==e&&t.value.consumerId!==this.id?t.done&&n.apply(this,arguments):n.apply(this,arguments)};let u=s.releaseBackpressure;return s.releaseBackpressure=function(t){!t.value||t.value.stream!==e&&t.value.consumerId!==this.id?t.done&&u.apply(this,arguments):u.apply(this,arguments)},s}stream(e){return new r(this,e)}}},{"./demuxed-consumable-stream":2,"writable-consumable-stream":5}],4:[function(e,t){t.exports=class{constructor(e,t,s,r){this.id=t,this._backpressure=0,this.stream=e,this.currentNode=s,this.timeout=r,this._isIterating=!1,this.stream.setConsumer(this.id,this)}getStats(){let e={id:this.id,backpressure:this._backpressure};return null!=this.timeout&&(e.timeout=this.timeout),e}resetBackpressure(){this._backpressure=0}applyBackpressure(){this._backpressure++}releaseBackpressure(){this._backpressure--}getBackpressure(){return this._backpressure}write(e){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),delete this._timeoutId),this.applyBackpressure(e),this._resolve&&(this._resolve(),delete this._resolve)}kill(e){void 0!==this._timeoutId&&(clearTimeout(this._timeoutId),delete this._timeoutId),this._isIterating?(this._killPacket={value:e,done:!0},this.applyBackpressure(this._killPacket)):(this.stream.removeConsumer(this.id),this.resetBackpressure()),this._resolve&&(this._resolve(),delete this._resolve)}async _waitForNextItem(e){return new Promise((t,s)=>{let r;if(this._resolve=t,void 0!==e){let t=new Error("Stream consumer iteration timed out");(async()=>{let i=function(e){let t,s=new Promise(s=>{t=setTimeout(s,e)});return{timeoutId:t,promise:s}}(e);r=i.timeoutId,await i.promise,t.name="TimeoutError",delete this._resolve,s(t)})()}this._timeoutId=r})}async next(){for(this._isIterating=!0,this.stream.setConsumer(this.id,this);;){if(!this.currentNode.next)try{await this._waitForNextItem(this.timeout)}catch(e){throw this._isIterating=!1,this.stream.removeConsumer(this.id),e}if(this._killPacket){this._isIterating=!1,this.stream.removeConsumer(this.id),this.resetBackpressure();let e=this._killPacket;return delete this._killPacket,e}if(this.currentNode=this.currentNode.next,this.releaseBackpressure(this.currentNode.data),!this.currentNode.consumerId||this.currentNode.consumerId===this.id)return this.currentNode.data.done&&(this._isIterating=!1,this.stream.removeConsumer(this.id)),this.currentNode.data}}return(){return delete this.currentNode,this._isIterating=!1,this.stream.removeConsumer(this.id),this.resetBackpressure(),{}}}},{}],5:[function(e,t){const s=e("consumable-stream"),r=e("./consumer");t.exports=class extends s{constructor(){super(),this.nextConsumerId=1,this._consumers={},this._tailNode={next:null,data:{value:void 0,done:!1}}}_write(e,t,s){let r={data:{value:e,done:t},next:null};s&&(r.consumerId=s),this._tailNode.next=r,this._tailNode=r;let i=Object.values(this._consumers),n=i.length;for(let e=0;e<n;e++){i[e].write(r.data)}}write(e){this._write(e,!1)}close(e){this._write(e,!0)}writeToConsumer(e,t){this._write(t,!1,e)}closeConsumer(e,t){this._write(t,!0,e)}kill(e){let t=Object.keys(this._consumers),s=t.length;for(let r=0;r<s;r++)this.killConsumer(t[r],e)}killConsumer(e,t){let s=this._consumers[e];s&&s.kill(t)}getBackpressure(){let e=Object.values(this._consumers),t=e.length,s=0;for(let r=0;r<t;r++){let t=e[r].getBackpressure();t>s&&(s=t)}return s}getConsumerBackpressure(e){let t=this._consumers[e];return t?t.getBackpressure():0}hasConsumer(e){return!!this._consumers[e]}setConsumer(e,t){this._consumers[e]=t,t.currentNode||(t.currentNode=this._tailNode)}removeConsumer(e){delete this._consumers[e]}getConsumerStats(e){let t=this._consumers[e];if(t)return t.getStats()}getConsumerStatsList(){let e=[],t=Object.values(this._consumers),s=t.length;for(let r=0;r<s;r++){let s=t[r];e.push(s.getStats())}return e}createConsumer(e){return new r(this,this.nextConsumerId++,this._tailNode,e)}}},{"./consumer":4,"consumable-stream":1}],"async-stream-emitter":[function(e,t){const s=e("stream-demux");function r(){this._listenerDemux=new s}r.prototype.emit=function(e,t){this._listenerDemux.write(e,t)},r.prototype.listener=function(e){return this._listenerDemux.stream(e)},r.prototype.closeListener=function(e){this._listenerDemux.close(e)},r.prototype.closeAllListeners=function(){this._listenerDemux.closeAll()},r.prototype.getListenerConsumerStats=function(e){return this._listenerDemux.getConsumerStats(e)},r.prototype.getListenerConsumerStatsList=function(e){return this._listenerDemux.getConsumerStatsList(e)},r.prototype.getAllListenersConsumerStatsList=function(){return this._listenerDemux.getConsumerStatsListAll()},r.prototype.killListener=function(e){this._listenerDemux.kill(e)},r.prototype.killAllListeners=function(){this._listenerDemux.killAll()},r.prototype.killListenerConsumer=function(e){this._listenerDemux.killConsumer(e)},r.prototype.getListenerBackpressure=function(e){return this._listenerDemux.getBackpressure(e)},r.prototype.getAllListenersBackpressure=function(){return this._listenerDemux.getBackpressureAll()},r.prototype.getListenerConsumerBackpressure=function(e){return this._listenerDemux.getConsumerBackpressure(e)},r.prototype.hasListenerConsumer=function(e,t){return this._listenerDemux.hasConsumer(e,t)},r.prototype.hasAnyListenerConsumer=function(e){return this._listenerDemux.hasConsumerAll(e)},t.exports=r},{"stream-demux":3}]},{},["async-stream-emitter"])("async-stream-emitter")});export default AsyncStreamEmitter;